CREATE TABLE block (id BIGSERIAL, parent_id BIGINT DEFAULT 0, page_id BIGINT NOT NULL, block_link_id BIGINT DEFAULT 0, header VARCHAR(255) DEFAULT NULL, type VARCHAR(14) DEFAULT 'text' NOT NULL, sort VARCHAR(8) DEFAULT 'hand' NOT NULL, sort_type VARCHAR(4) DEFAULT 'asc' NOT NULL, visible BOOLEAN DEFAULT 'true', css TEXT DEFAULT NULL, by_default BOOLEAN DEFAULT 'true', azlist_show BOOLEAN DEFAULT 'false', item_per_page BIGINT DEFAULT 0 NOT NULL, s_order BIGINT DEFAULT 0, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE block_link (id BIGSERIAL, block_id BIGINT DEFAULT 0, entity_id BIGINT DEFAULT 0, s_order BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE capcha (id BIGSERIAL, picture VARCHAR(255) NOT NULL, value VARCHAR(10) DEFAULT NULL, PRIMARY KEY(id));
CREATE TABLE comment (id BIGSERIAL, block_id BIGINT DEFAULT 0, username VARCHAR(255) DEFAULT 'Anonymous' NOT NULL, content TEXT DEFAULT '' NOT NULL, visible BOOLEAN DEFAULT 'true', created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE media (id BIGSERIAL, block_id BIGINT NOT NULL, filename VARCHAR(255) NOT NULL, filepath TEXT NOT NULL, mimetype VARCHAR(32), filesize BIGINT, metadata TEXT, dtype SMALLINT, date TIMESTAMP, visible BOOLEAN DEFAULT 'true', s_order BIGINT DEFAULT 0, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE menu (id BIGSERIAL, parent_id BIGINT NOT NULL, block_id BIGINT NOT NULL, alias VARCHAR(255) DEFAULT NULL, type VARCHAR(10) DEFAULT 'horizontal' NOT NULL, s_order BIGINT DEFAULT 0, PRIMARY KEY(id));
CREATE TABLE page (id BIGSERIAL, header VARCHAR(255) DEFAULT NULL, type VARCHAR(32) DEFAULT 'user' NOT NULL, meta_keywords TEXT DEFAULT NULL, meta_description TEXT DEFAULT NULL, meta_indexing BOOLEAN DEFAULT 'true', created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE settings (id BIGSERIAL, header VARCHAR(255) DEFAULT NULL, var VARCHAR(255) NOT NULL, value VARCHAR(255) NOT NULL, checkbox BOOLEAN DEFAULT 'true', PRIMARY KEY(id));
CREATE TABLE text (id BIGSERIAL, block_id BIGINT NOT NULL, content TEXT DEFAULT NULL, created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE TABLE text_list (id BIGSERIAL, block_id BIGINT NOT NULL, header VARCHAR(255) DEFAULT NULL, description TEXT DEFAULT NULL, content TEXT DEFAULT NULL, author VARCHAR(255) DEFAULT NULL, date TIMESTAMP, thumb TEXT DEFAULT NULL, visible BOOLEAN DEFAULT 'true', s_order BIGINT DEFAULT 0, meta_keywords TEXT DEFAULT NULL, meta_description TEXT DEFAULT NULL, meta_indexing BOOLEAN DEFAULT 'true', created_at TIMESTAMP NOT NULL, updated_at TIMESTAMP NOT NULL, PRIMARY KEY(id));
CREATE INDEX block_parent_id ON block (parent_id);
CREATE INDEX block_page_id ON block (page_id);
CREATE INDEX block_link_entity_id ON block_link (entity_id);
CREATE INDEX menu_parent_id ON menu (parent_id);
ALTER TABLE block ADD CONSTRAINT block_page_id_page_id FOREIGN KEY (page_id) REFERENCES page(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE block_link ADD CONSTRAINT block_link_block_id_block_id FOREIGN KEY (block_id) REFERENCES block(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE comment ADD CONSTRAINT comment_block_id_block_id FOREIGN KEY (block_id) REFERENCES block(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE media ADD CONSTRAINT media_block_id_block_id FOREIGN KEY (block_id) REFERENCES block(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE menu ADD CONSTRAINT menu_block_id_page_id FOREIGN KEY (block_id) REFERENCES page(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE text ADD CONSTRAINT text_block_id_block_id FOREIGN KEY (block_id) REFERENCES block(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
ALTER TABLE text_list ADD CONSTRAINT text_list_block_id_block_id FOREIGN KEY (block_id) REFERENCES block(id) ON UPDATE CASCADE ON DELETE CASCADE NOT DEFERRABLE INITIALLY IMMEDIATE;
